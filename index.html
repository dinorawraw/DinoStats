<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>StreamerStats Brasil - Estatísticas Gerais</title>
  <meta name="description" content="Plataforma de análise do cenário brasileiro da Twitch - Descubra os melhores horários, jogos populares e tendências para crescer na plataforma">
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAABR0lEQVQ4jZ2TvUoDQRSFv9ndhGQTNYkgaGMhiKKFhYU/hYiVYGsrvoGFT2DnM/gEYmcjgoWFhYVgYSGIGo0aE7Ob7K7FJrubGYNGDwwzc+/5zjn3zgz8s5TvQTqdVuPxeEjXdQxNw/M8PM/D931c18V1XQqFglwoFNhst9krlXgcj8e/FKSU+L6PpmmEQiE0TcNxHGq1GvV6/c1xnLxt28znczxPJlwlk1EhxLeiQghc10UIged5CCGwLItms0m73f7wPO9pNpvdyuVyD6urKyv+QiaTUaPRKMViEdd1aTQatFotTNOk1+sxHA7xfR9QKIQsy0/j8fhGKpXaVxQFkVxfQ9d1HVRRGI1GDwYBer4dt20gp8TwPwzAIBAKvhmGsm6b5LKSUStM0AoEAQggmkwmWZWFZFp7nIaVESkkwGERVVSzLOsxms7fAO/wRfQIoMqJu8Yx+2QAAAABJRU5ErkJggg==">
  <script src="https://unpkg.com/vue@3.5.13/dist/vue.global.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-900 text-gray-100">
  <div id="app" class="min-h-screen">
    <!-- Navbar -->
    <nav class="bg-gradient-to-r from-gray-900 to-gray-800 text-white shadow-lg border-b border-purple-500/30 backdrop-blur-sm">
      <div class="container mx-auto px-4 py-3">
        <div class="flex justify-between items-center">
          <h1 class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-purple-400 to-purple-600">Dino Stats</h1>
          <span class="text-sm text-gray-400">Estatísticas Gerais da Twitch BR</span>
        </div>
      </div>
    </nav>

    <main class="container mx-auto px-4 py-8">
      <!-- Exibe loading ou erro -->
      <div v-if="loading" class="text-center py-8">
        <p>Carregando dados...</p>
      </div>
      <div v-else-if="error" class="text-center py-8 text-red-500">
        <p>{{ error }}</p>
      </div>
      <!-- Dashboard Grid -->
      <div v-else class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        <!-- Exemplo de Card com Gráfico -->
        <div class="bg-gradient-to-br from-gray-800/80 to-gray-900/80 rounded-xl shadow-xl p-6 border border-purple-500/20 backdrop-blur-sm transition-all duration-300 hover:shadow-2xl hover:shadow-purple-500/10">
          <h2 class="text-2xl font-bold mb-4 bg-clip-text text-transparent bg-gradient-to-r from-purple-400 to-purple-600">
            Categorias com Mais Views e Menos Streamers
          </h2>
          <div class="relative h-64">
            <canvas ref="highViewsLowStreamersChart"></canvas>
          </div>
          <div class="mt-4">
            <p class="text-gray-600">Categorias com alta audiência e poucos streamers ativos.</p>
          </div>
        </div>
        <!-- Outros cards podem ser adicionados aqui -->
      </div>
    </main>
  </div>

  <script type="module">
    const { createApp, ref, onMounted } = Vue;

    createApp({
      setup() {
        // Configurações da Twitch
        const TWITCH_CLIENT_ID = 'ujqugm0jg9rfesg80w0g617zit55lr';
        const TWITCH_CLIENT_SECRET = 'tuoyv6mbk7fijc5q4maerbkerexdaf';
        // Armazena o token de forma reativa
        const TWITCH_AUTH_TOKEN = ref('');

        // Refs para os gráficos
        const highViewsLowStreamersChart = ref(null);
        // Outros gráficos podem ser adicionados da mesma forma

        // Dados reativos
        const categoriesData = ref([]);
        const quickStats = ref([
          { label: 'Streamers Ativos', value: '12K', trend: 8 },
          { label: 'Audiência Total', value: '450K', trend: 12 },
          { label: 'Jogos Populares', value: '25', trend: 5 }
        ]);
        const loading = ref(true);
        const error = ref('');

        // Gera o token de autenticação
        const generateAuthToken = async () => {
          try {
            const response = await fetch('https://id.twitch.tv/oauth2/token', {
              method: 'POST',
              headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
              body: new URLSearchParams({
                client_id: TWITCH_CLIENT_ID,
                client_secret: TWITCH_CLIENT_SECRET,
                grant_type: 'client_credentials'
              })
            });
            const data = await response.json();
            if (data.access_token) {
              TWITCH_AUTH_TOKEN.value = data.access_token;
            } else {
              throw new Error('Token não recebido.');
            }
          } catch (err) {
            console.error('Erro ao gerar token:', err);
            error.value = 'Erro na autenticação com a Twitch.';
          }
        };

        // Busca os dados da Twitch
        const fetchTwitchData = async () => {
          if (!TWITCH_AUTH_TOKEN.value) return;
          try {
            const headers = {
              'Client-ID': TWITCH_CLIENT_ID,
              'Authorization': `Bearer ${TWITCH_AUTH_TOKEN.value}`
            };
            const response = await fetch('https://api.twitch.tv/helix/streams?language=pt&first=100', { headers });
            if (!response.ok) {
              throw new Error(`Erro: ${response.statusText}`);
            }
            const data = await response.json();
            if (!data.data) {
              throw new Error('Dados inválidos retornados pela API.');
            }
            // Agrupa os dados por categoria
            const categories = data.data.reduce((acc, stream) => {
              const gameId = stream.game_id;
              if (!acc[gameId]) {
                acc[gameId] = { name: stream.game_name, viewers: 0, streamers: 0 };
              }
              acc[gameId].viewers += stream.viewer_count;
              acc[gameId].streamers += 1;
              return acc;
            }, {});
            categoriesData.value = Object.values(categories);
          } catch (err) {
            console.error('Erro ao buscar dados da Twitch:', err);
            error.value = 'Erro ao buscar dados da Twitch.';
          }
        };

        // Filtra categorias com mais views e menos streamers
        const findHighViewsLowStreamers = (categories) => {
          if (!categories || categories.length === 0) return [];
          return categories
            .sort((a, b) => b.viewers - a.viewers || a.streamers - b.streamers)
            .slice(0, 10);
        };

        // Inicializa o gráfico
        const initializeCharts = () => {
          const filteredCategories = findHighViewsLowStreamers(categoriesData.value);
          if (filteredCategories.length === 0) {
            console.error('Nenhuma categoria filtrada para exibir no gráfico.');
            return;
          }
          const ctx = highViewsLowStreamersChart.value.getContext('2d');
          if (!ctx) {
            console.error('Contexto do canvas não encontrado.');
            return;
          }
          new Chart(ctx, {
            type: 'bar',
            data: {
              labels: filteredCategories.map(category => category.name),
              datasets: [
                {
                  label: 'Audiência (Views)',
                  data: filteredCategories.map(category => category.viewers),
                  backgroundColor: '#7C3AED'
                },
                {
                  label: 'Streamers Ativos',
                  data: filteredCategories.map(category => category.streamers),
                  backgroundColor: '#60A5FA'
                }
              ]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                y: {
                  beginAtZero: true,
                  title: { display: true, text: 'Quantidade' }
                }
              },
              plugins: {
                legend: { position: 'top' }
              }
            }
          });
        };

        // Ciclo de vida: ao montar, gera o token, busca os dados e inicializa os gráficos
        onMounted(async () => {
          await generateAuthToken();
          if (TWITCH_AUTH_TOKEN.value) {
            await fetchTwitchData();
            initializeCharts();
          }
          loading.value = false;
        });

        return { quickStats, highViewsLowStreamersChart, loading, error };
      }
    }).mount('#app');
  </script>
</body>
</html>
